<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bayes Filters Library: How to decorate classes to add functionalities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bayes Filters Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to decorate classes to add functionalities </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a href="https://en.wikipedia.org/wiki/Decorator_pattern"><em>Decroator patter</em></a> is extensively used within the library to dynamically add new functionality to other classes. This is particularly useful to design flexible and reusable object-oriented software providing an alternative to subclassing. In particular, when there are <b>several independent ways of extending functionality</b> and it is difficult to predict, at design time, what combinations of such functionalities will be needed, subclassing would require to make every possible (or most of the) combination of such functionalities, while <b>decorators provide much more flexibility combining functionalities on a per-use basis and foster code reuse</b>.<br />
</p>
<p>The following snippet code shows how to decorate filtering classes like <a class="el" href="classbfl_1_1StateModel.html">StateModel</a>, ObservationModel, <a class="el" href="classbfl_1_1PFPrediction.html">PFPrediction</a> and <a class="el" href="classbfl_1_1PFCorrection.html">PFCorrection</a>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;random&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="BootstrapCorrection_8h.html">BayesFilters/BootstrapCorrection.h</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="DrawParticles_8h.html">BayesFilters/DrawParticles.h</a>&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GaussianLikelihood_8h.html">BayesFilters/GaussianLikelihood.h</a>&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="InitSurveillanceAreaGrid_8h.html">BayesFilters/InitSurveillanceAreaGrid.h</a>&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="SimulatedLinearSensor_8h.html">BayesFilters/SimulatedLinearSensor.h</a>&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="LikelihoodModel_8h.html">BayesFilters/LikelihoodModel.h</a>&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="MeasurementModelDecorator_8h.html">BayesFilters/MeasurementModelDecorator.h</a>&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="ParticleSet_8h.html">BayesFilters/ParticleSet.h</a>&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="ParticleSetInitialization_8h.html">BayesFilters/ParticleSetInitialization.h</a>&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="PFCorrectionDecorator_8h.html">BayesFilters/PFCorrectionDecorator.h</a>&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="PFPredictionDecorator_8h.html">BayesFilters/PFPredictionDecorator.h</a>&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="SimulatedStateModel_8h.html">BayesFilters/SimulatedStateModel.h</a>&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="Resampling_8h.html">BayesFilters/Resampling.h</a>&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="StateModelDecorator_8h.html">BayesFilters/StateModelDecorator.h</a>&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="SIS_8h.html">BayesFilters/SIS.h</a>&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="WhiteNoiseAcceleration_8h.html">BayesFilters/WhiteNoiseAcceleration.h</a>&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="utils_8h.html">BayesFilters/utils.h</a>&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;Eigen/Dense&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacebfl.html">bfl</a>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceEigen.html">Eigen</a>;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">class </span>DecoratedWNA : <span class="keyword">public</span> <a class="code" href="classbfl_1_1StateModelDecorator.html">StateModelDecorator</a></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    DecoratedWNA(std::unique_ptr&lt;StateModel&gt; state_model) noexcept :</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <a class="code" href="classbfl_1_1StateModelDecorator.html">StateModelDecorator</a>(std::move(state_model))</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    { };</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordtype">void</span> motion(<span class="keyword">const</span> Eigen::Ref&lt;const Eigen::MatrixXd&gt;&amp; cur_states, Eigen::Ref&lt;Eigen::MatrixXd&gt; mot_states)<span class="keyword"> override</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Decorator: DecoratedWNA::motion().&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <a class="code" href="classbfl_1_1StateModelDecorator.html#af0ffeccf4bfcf8ddb36f3e6704fae7d2">StateModelDecorator::motion</a>(cur_states, mot_states);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;};</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">class </span>DecoratedLinearSensor : <span class="keyword">public</span> <a class="code" href="classbfl_1_1MeasurementModelDecorator.html">MeasurementModelDecorator</a></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    DecoratedLinearSensor(std::unique_ptr&lt;MeasurementModel&gt; observation_model) noexcept :</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="classbfl_1_1MeasurementModelDecorator.html">MeasurementModelDecorator</a>(std::move(observation_model))</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    { }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    std::pair&lt;bool, bfl::Data&gt; measure()<span class="keyword"> const override</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Decorator: DecoratedLinearSensor::measure().&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classbfl_1_1MeasurementModelDecorator.html#a36194c2f6abd7e13a417c3663febe921">MeasurementModelDecorator::measure</a>();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;};</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">class </span>DecoratedDrawParticles : <span class="keyword">public</span> <a class="code" href="classbfl_1_1PFPredictionDecorator.html">PFPredictionDecorator</a></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    DecoratedDrawParticles(std::unique_ptr&lt;PFPrediction&gt; prediction) noexcept :</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="classbfl_1_1PFPredictionDecorator.html">PFPredictionDecorator</a>(std::move(prediction))</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    { }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">void</span> predictStep(<span class="keyword">const</span> <a class="code" href="classbfl_1_1ParticleSet.html">ParticleSet</a>&amp; prev_particles, <a class="code" href="classbfl_1_1ParticleSet.html">ParticleSet</a>&amp; pred_particles)<span class="keyword"> override</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Decorator: DecoratedDrawParticles::predictStep().&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="classbfl_1_1PFPredictionDecorator.html#a570bd3a338034e65c1fa5abee429e717">PFPredictionDecorator::predictStep</a>(prev_particles, pred_particles);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;};</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">class </span>DecoratedBootstrapCorrection : <span class="keyword">public</span> <a class="code" href="classbfl_1_1PFCorrectionDecorator.html">PFCorrectionDecorator</a></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    DecoratedBootstrapCorrection(std::unique_ptr&lt;PFCorrection&gt; correction) noexcept :</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="classbfl_1_1PFCorrectionDecorator.html">PFCorrectionDecorator</a>(std::move(correction))</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    { }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">void</span> correctStep(<span class="keyword">const</span> <a class="code" href="classbfl_1_1ParticleSet.html">ParticleSet</a>&amp; pred_particles, <a class="code" href="classbfl_1_1ParticleSet.html">ParticleSet</a>&amp; cor_particles)<span class="keyword"> override</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Decorator: DecoratedBootstrapCorrection::correctStep().&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="classbfl_1_1PFCorrectionDecorator.html#a83bb9ac8ba168f99f211973ae634391a">PFCorrectionDecorator::correctStep</a>(pred_particles, cor_particles);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;};</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">class </span>SISSimulation : <span class="keyword">public</span> <a class="code" href="classbfl_1_1SIS.html">SIS</a></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    SISSimulation</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    (</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_particle,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        std::size_t state_size,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> simulation_steps,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        std::unique_ptr&lt;ParticleSetInitialization&gt; initialization,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        std::unique_ptr&lt;PFPrediction&gt; prediction,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        std::unique_ptr&lt;PFCorrection&gt; correction,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        std::unique_ptr&lt;Resampling&gt; resampling</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    ) noexcept :</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <a class="code" href="classbfl_1_1SIS.html">SIS</a>(num_particle, state_size, std::move(initialization), std::move(prediction), std::move(correction), std::move(resampling)),</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        simulation_steps_(simulation_steps)</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    { }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">bool</span> runCondition()</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> (getFilteringStep() &lt; simulation_steps_)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> simulation_steps_;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;};</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">int</span> main()</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">/* A set of parameters needed to run a SIS particle filter in a simulated environment. */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">double</span> surv_x = 1000.0;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">double</span> surv_y = 1000.0;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_particle_x = 100;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_particle_y = 100;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_particle = num_particle_x * num_particle_y;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    Vector4d initial_state(10.0f, 0.0f, 10.0f, 0.0f);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> simulation_time = 10;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    std::size_t state_size = 4;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">/* Step 1 - Initialization */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">/* Initialize initialization class. */</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    std::unique_ptr&lt;ParticleSetInitialization&gt; grid_initialization = utils::make_unique&lt;InitSurveillanceAreaGrid&gt;(surv_x, surv_y, num_particle_x, num_particle_y);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">/* Step 2 - Prediction */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">/* Step 2.1 - Define the state model */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">/* Initialize a white noise acceleration state model. */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    std::unique_ptr&lt;StateModel&gt; wna = utils::make_unique&lt;WhiteNoiseAcceleration&gt;();</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">/* Step 2.1.1 - Define a decoration for the state model */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/* Initialize a white noise acceleration decorator. */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    std::unique_ptr&lt;StateModel&gt; decorated_wna = utils::make_unique&lt;DecoratedWNA&gt;(std::move(wna));</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">/* Step 2.2 - Define the prediction step */</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">/* Initialize the particle filter prediction step and pass the ownership of the state model. */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    std::unique_ptr&lt;PFPrediction&gt; pf_prediction = utils::make_unique&lt;DrawParticles&gt;();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    pf_prediction-&gt;setStateModel(std::move(decorated_wna));</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">/* Step 2.2.1 - Define a decoration for the prediction step */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">/* Initialize a particle filter prediction decorator. */</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    std::unique_ptr&lt;PFPrediction&gt; decorated_prediction = utils::make_unique&lt;DecoratedDrawParticles&gt;(std::move(pf_prediction));</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">/* Step 3 - Correction */</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">/* Step 3.1 - Define where the measurement are originated from (either simulated or from a real process) */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">/* Initialize simulaterd target model, a white noise acceleration, and measurements, a MeasurementModel decoration for the linear sensor. */</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    std::unique_ptr&lt;StateModel&gt; target_model = utils::make_unique&lt;WhiteNoiseAcceleration&gt;();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    std::unique_ptr&lt;SimulatedStateModel&gt; simulated_state_model = utils::make_unique&lt;SimulatedStateModel&gt;(std::move(target_model), initial_state, simulation_time);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">/* Initialize a measurement model (a linear sensor reading x and y coordinates). */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    std::unique_ptr&lt;MeasurementModel&gt; simulated_linear_sensor = utils::make_unique&lt;SimulatedLinearSensor&gt;(std::move(simulated_state_model));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">/* Step 3.1.1 - Define a decoration for the measurement model */</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">/* Initialize a white noise acceleration decorator */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    std::unique_ptr&lt;MeasurementModel&gt; decorated_linearsensor = utils::make_unique&lt;DecoratedLinearSensor&gt;(std::move(simulated_linear_sensor));</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">/* Step 3.2 - Define the likelihood model */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">/* Initialize the the exponential likelihood, a PFCorrection decoration of the particle filter correction step. */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    std::unique_ptr&lt;LikelihoodModel&gt; exp_likelihood = utils::make_unique&lt;GaussianLikelihood&gt;();</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">/* Step 3.3 - Define the correction step */</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">/* Initialize the particle filter correction step and pass the ownership of the measurement model. */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    std::unique_ptr&lt;PFCorrection&gt; pf_correction = utils::make_unique&lt;BoostrapCorrection&gt;();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    pf_correction-&gt;setLikelihoodModel(std::move(exp_likelihood));</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    pf_correction-&gt;setMeasurementModel(std::move(decorated_linearsensor));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">/* Initialize a update particle decorator */</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    std::unique_ptr&lt;PFCorrection&gt; decorated_correction = utils::make_unique&lt;DecoratedBootstrapCorrection&gt;(std::move(pf_correction));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/* Step 4 - Resampling */</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">/* Initialize a resampling algorithm */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    std::unique_ptr&lt;Resampling&gt; resampling = utils::make_unique&lt;Resampling&gt;();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">/* Step 5 - Assemble the particle filter */</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Constructing SIS particle filter...&quot;</span> &lt;&lt; std::flush;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    SISSimulation sis_pf(num_particle, state_size, simulation_time, std::move(grid_initialization), std::move(decorated_prediction), std::move(decorated_correction), std::move(resampling));</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;done!&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">/* Step 6 - Prepare the filter to be run */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Booting SIS particle filter...&quot;</span> &lt;&lt; std::flush;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    sis_pf.boot();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;completed!&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">/* Step 7 - Run the filter and wait until it is closed */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">/* Note that since this is a simulation, the filter will end upon simulation termination */</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Running SIS particle filter...&quot;</span> &lt;&lt; std::flush;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    sis_pf.run();</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;waiting...&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (!sis_pf.wait())</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;completed!&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="ttc" id="classbfl_1_1StateModelDecorator_html_af0ffeccf4bfcf8ddb36f3e6704fae7d2"><div class="ttname"><a href="classbfl_1_1StateModelDecorator.html#af0ffeccf4bfcf8ddb36f3e6704fae7d2">bfl::StateModelDecorator::motion</a></div><div class="ttdeci">void motion(const Eigen::Ref&lt; const Eigen::MatrixXd &gt; &amp;cur_states, Eigen::Ref&lt; Eigen::MatrixXd &gt; mot_states) override</div><div class="ttdef"><b>Definition:</b> <a href="StateModelDecorator_8cpp_source.html#l00032">StateModelDecorator.cpp:32</a></div></div>
<div class="ttc" id="DrawParticles_8h_html"><div class="ttname"><a href="DrawParticles_8h.html">DrawParticles.h</a></div></div>
<div class="ttc" id="classbfl_1_1ParticleSet_html"><div class="ttname"><a href="classbfl_1_1ParticleSet.html">bfl::ParticleSet</a></div><div class="ttdef"><b>Definition:</b> <a href="ParticleSet_8h_source.html#l00013">ParticleSet.h:13</a></div></div>
<div class="ttc" id="MeasurementModelDecorator_8h_html"><div class="ttname"><a href="MeasurementModelDecorator_8h.html">MeasurementModelDecorator.h</a></div></div>
<div class="ttc" id="GaussianLikelihood_8h_html"><div class="ttname"><a href="GaussianLikelihood_8h.html">GaussianLikelihood.h</a></div></div>
<div class="ttc" id="LikelihoodModel_8h_html"><div class="ttname"><a href="LikelihoodModel_8h.html">LikelihoodModel.h</a></div></div>
<div class="ttc" id="namespaceEigen_html"><div class="ttname"><a href="namespaceEigen.html">Eigen</a></div></div>
<div class="ttc" id="WhiteNoiseAcceleration_8h_html"><div class="ttname"><a href="WhiteNoiseAcceleration_8h.html">WhiteNoiseAcceleration.h</a></div></div>
<div class="ttc" id="BootstrapCorrection_8h_html"><div class="ttname"><a href="BootstrapCorrection_8h.html">BootstrapCorrection.h</a></div></div>
<div class="ttc" id="SimulatedStateModel_8h_html"><div class="ttname"><a href="SimulatedStateModel_8h.html">SimulatedStateModel.h</a></div></div>
<div class="ttc" id="SIS_8h_html"><div class="ttname"><a href="SIS_8h.html">SIS.h</a></div></div>
<div class="ttc" id="classbfl_1_1PFPredictionDecorator_html"><div class="ttname"><a href="classbfl_1_1PFPredictionDecorator.html">bfl::PFPredictionDecorator</a></div><div class="ttdef"><b>Definition:</b> <a href="PFPredictionDecorator_8h_source.html#l00014">PFPredictionDecorator.h:14</a></div></div>
<div class="ttc" id="classbfl_1_1MeasurementModelDecorator_html_a36194c2f6abd7e13a417c3663febe921"><div class="ttname"><a href="classbfl_1_1MeasurementModelDecorator.html#a36194c2f6abd7e13a417c3663febe921">bfl::MeasurementModelDecorator::measure</a></div><div class="ttdeci">std::pair&lt; bool, bfl::Data &gt; measure() const override</div><div class="ttdef"><b>Definition:</b> <a href="MeasurementModelDecorator_8cpp_source.html#l00026">MeasurementModelDecorator.cpp:26</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="utils_8h.html">utils.h</a></div></div>
<div class="ttc" id="PFPredictionDecorator_8h_html"><div class="ttname"><a href="PFPredictionDecorator_8h.html">PFPredictionDecorator.h</a></div></div>
<div class="ttc" id="PFCorrectionDecorator_8h_html"><div class="ttname"><a href="PFCorrectionDecorator_8h.html">PFCorrectionDecorator.h</a></div></div>
<div class="ttc" id="SimulatedLinearSensor_8h_html"><div class="ttname"><a href="SimulatedLinearSensor_8h.html">SimulatedLinearSensor.h</a></div></div>
<div class="ttc" id="Resampling_8h_html"><div class="ttname"><a href="Resampling_8h.html">Resampling.h</a></div></div>
<div class="ttc" id="classbfl_1_1StateModelDecorator_html"><div class="ttname"><a href="classbfl_1_1StateModelDecorator.html">bfl::StateModelDecorator</a></div><div class="ttdef"><b>Definition:</b> <a href="StateModelDecorator_8h_source.html#l00013">StateModelDecorator.h:13</a></div></div>
<div class="ttc" id="StateModelDecorator_8h_html"><div class="ttname"><a href="StateModelDecorator_8h.html">StateModelDecorator.h</a></div></div>
<div class="ttc" id="namespacebfl_html"><div class="ttname"><a href="namespacebfl.html">bfl</a></div><div class="ttdoc">Port of boost::any for C++11 compilers. </div><div class="ttdef"><b>Definition:</b> <a href="AdditiveMeasurementModel_8h_source.html#l00006">AdditiveMeasurementModel.h:6</a></div></div>
<div class="ttc" id="classbfl_1_1PFPredictionDecorator_html_a570bd3a338034e65c1fa5abee429e717"><div class="ttname"><a href="classbfl_1_1PFPredictionDecorator.html#a570bd3a338034e65c1fa5abee429e717">bfl::PFPredictionDecorator::predictStep</a></div><div class="ttdeci">void predictStep(const bfl::ParticleSet &amp;prev_particles, bfl::ParticleSet &amp;pred_particles) override</div><div class="ttdef"><b>Definition:</b> <a href="PFPredictionDecorator_8cpp_source.html#l00028">PFPredictionDecorator.cpp:28</a></div></div>
<div class="ttc" id="ParticleSet_8h_html"><div class="ttname"><a href="ParticleSet_8h.html">ParticleSet.h</a></div></div>
<div class="ttc" id="classbfl_1_1PFCorrectionDecorator_html_a83bb9ac8ba168f99f211973ae634391a"><div class="ttname"><a href="classbfl_1_1PFCorrectionDecorator.html#a83bb9ac8ba168f99f211973ae634391a">bfl::PFCorrectionDecorator::correctStep</a></div><div class="ttdeci">void correctStep(const bfl::ParticleSet &amp;pred_particles, bfl::ParticleSet &amp;cor_particles) override</div><div class="ttdef"><b>Definition:</b> <a href="PFCorrectionDecorator_8cpp_source.html#l00050">PFCorrectionDecorator.cpp:50</a></div></div>
<div class="ttc" id="ParticleSetInitialization_8h_html"><div class="ttname"><a href="ParticleSetInitialization_8h.html">ParticleSetInitialization.h</a></div></div>
<div class="ttc" id="classbfl_1_1SIS_html"><div class="ttname"><a href="classbfl_1_1SIS.html">bfl::SIS</a></div><div class="ttdef"><b>Definition:</b> <a href="SIS_8h_source.html#l00020">SIS.h:20</a></div></div>
<div class="ttc" id="classbfl_1_1MeasurementModelDecorator_html"><div class="ttname"><a href="classbfl_1_1MeasurementModelDecorator.html">bfl::MeasurementModelDecorator</a></div><div class="ttdef"><b>Definition:</b> <a href="MeasurementModelDecorator_8h_source.html#l00013">MeasurementModelDecorator.h:13</a></div></div>
<div class="ttc" id="classbfl_1_1PFCorrectionDecorator_html"><div class="ttname"><a href="classbfl_1_1PFCorrectionDecorator.html">bfl::PFCorrectionDecorator</a></div><div class="ttdef"><b>Definition:</b> <a href="PFCorrectionDecorator_8h_source.html#l00014">PFCorrectionDecorator.h:14</a></div></div>
<div class="ttc" id="InitSurveillanceAreaGrid_8h_html"><div class="ttname"><a href="InitSurveillanceAreaGrid_8h.html">InitSurveillanceAreaGrid.h</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
